[{"_id":{"$objectID":"5a7302ee14d02c3ab879c634"},"code":"exports = {\n  $PHONE_NUMBER_PROVIDED: function(args, callback) {\n    this.debug(\"copying over phone number\");\n    return callback(null, { phoneNumber: args.registrationNumber });\n  },\n  POST_UTME_SCREENING: function(args, callback) {\n    //check all the jamb blah blah\n    this.debug(\"checking jamb info\");\n    this.debug(\"app domain:\" + this.args.$appDomain._id);\n    const validators = {\n      minScore: function(info, config) {\n        if (!info.totalScore || info.totalScore < config.min)\n          return `You scored below the minimum required score stipulated by the University (${config.min})`;\n      },\n      regex: function(info, config) {\n        return (info[config.property] && new RegExp(config.regex).test(info[config.property])) || `Your ${config.property} is invalid`;\n      }\n    };\n    this.entityRepo.get(\n      \"JambList\",\n      { regNumb: args.registrationNumber, domain: this.args.$appDomain._id },\n      { one: true },\n      (er, jambInfo) => {\n        if (er) return callback(er);\n        if (!jambInfo) return callback(new Error(\"Sorry we cannot find your information from Jamb\"));\n\n        this.debug(\"successfully retrieved jamb info\");\n        this.debug(jambInfo);\n        this.debug(this.args.$appDomain.config);\n        if (!this.args.$appDomain.config.jambValidation) return callback();\n        let jambValidation = JSON.parse(this.args.$appDomain.config.jambValidation);\n        this.async.parallel(\n          jambValidation.map(v => {\n            return fn => {\n              let validator = validators[v.name];\n              if (!validator) return fn(new Error(\"Unknown Validator\"));\n              let result = validator(jambInfo, v);\n              if (typeof result === \"string\") return fn(new Error(result));\n              fn();\n            };\n          }),\n          er => {\n            if (er) return callback(er);\n\n            let disabled = [\"firstName\", \"middleName\", \"surname\"];\n            for (var i = 0; i < disabled.length; i++) {\n              let x = disabled[i];\n              let element = this.libs.findElementByName(this.args.$nextStep.form.elements, x);\n              if (!element) {\n                return callback(new Error(\"Cannot find element:\" + x));\n              }\n              if (!element.args) element.args = {};\n              element.args.disabled = true;\n            }\n            return callback(null, { firstName: jambInfo.firstName, middleName: jambInfo.middleName, surname: jambInfo.surname });\n          }\n        );\n      }\n    );\n  },\n  INTERNAL_SHOPPING: function(args, callback) {\n    let c = this.constants;\n    this.args.$nextStep.form.elements.push(\n      this.libs.createElement(\"jambRegNumber\", \"Matriculation Number\", \"\", c.ELEMENTTYPE.INPUT, { type: c.INPUTTYPE.TEXT }, [\n        this.libs.createRequiredValidator(),\n        this.libs.createRegexValidator(\"^\\\\d{6,8}[a-zA-Z]{2,2}$\", \"You must enter a valid jamb registration number\")\n      ])\n    );\n\n    return exports.$PHONE_NUMBER_PROVIDED.call(this, args, callback);\n  },\n  DIRECT_ENTRY: function(...args) {\n    exports.POST_UTME_SCREENING.apply(this, args);\n  },\n  ADMISSION_SHOPPING: function(...args) {\n    exports.POST_UTME_SCREENING.apply(this, args);\n  },\n  JUPEB_APP_FORM: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  },\n  PG_APP_FORM: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  },\n  DIPLOMA_UNDERGRADUATE: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  },\n  EXECUTIVE_DIPLOMA_FORM: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  }\n};\n","uid":"APPLICATION_INVOICE_GENERATION_VALIDATION","__v":0,"_references":["findElementByName","createElement","createRequiredValidator","createRegexValidator"],"_code":"exports = {\n  $PHONE_NUMBER_PROVIDED: function(args, callback) {\ntry{\n{\n    this.debug(\"copying over phone number\");\n    return callback(null, { phoneNumber: args.registrationNumber });\n  }\n} catch(e){\n//an unexpected error has just occurred. \n callback(e);}},\n  POST_UTME_SCREENING: function(args, callback) {\ntry{\n{\n    //check all the jamb blah blah\n    this.debug(\"checking jamb info\");\n    this.debug(\"app domain:\" + this.args.$appDomain._id);\n    const validators = {\n      minScore: function(info, config) {\n        if (!info.totalScore || info.totalScore < config.min)\n          return `You scored below the minimum required score stipulated by the University (${config.min})`;\n      },\n      regex: function(info, config) {\n        return (info[config.property] && new RegExp(config.regex).test(info[config.property])) || `Your ${config.property} is invalid`;\n      }\n    };\n    this.entityRepo.get(\n      \"JambList\",\n      { regNumb: args.registrationNumber, domain: this.args.$appDomain._id },\n      { one: true },\n      (er, jambInfo) => {\ntry{\n{\n        if (er) return callback(er);\n        if (!jambInfo) return callback(new Error(\"Sorry we cannot find your information from Jamb\"));\n\n        this.debug(\"successfully retrieved jamb info\");\n        this.debug(jambInfo);\n        this.debug(this.args.$appDomain.config);\n        if (!this.args.$appDomain.config.jambValidation) return callback();\n        let jambValidation = JSON.parse(this.args.$appDomain.config.jambValidation);\n        this.async.parallel(\n          jambValidation.map(v => {\n            return fn => {\ntry{\n{\n              let validator = validators[v.name];\n              if (!validator) return fn(new Error(\"Unknown Validator\"));\n              let result = validator(jambInfo, v);\n              if (typeof result === \"string\") return fn(new Error(result));\n              fn();\n            }\n} catch(e){\n//an unexpected error has just occurred. \n fn(e);}};\n          }),\n          er => {\ntry{\n{\n            if (er) return callback(er);\n\n            let disabled = [\"firstName\", \"middleName\", \"surname\"];\n            for (var i = 0; i < disabled.length; i++) {\n              let x = disabled[i];\n              let element = this.libs.findElementByName(this.args.$nextStep.form.elements, x);\n              if (!element) {\n                return callback(new Error(\"Cannot find element:\" + x));\n              }\n              if (!element.args) element.args = {};\n              element.args.disabled = true;\n            }\n            return callback(null, { firstName: jambInfo.firstName, middleName: jambInfo.middleName, surname: jambInfo.surname });\n          }\n} catch(e){\n//an unexpected error has just occurred. \n callback(e);}}\n        );\n      }\n} catch(e){\n//an unexpected error has just occurred. \n callback(e);}}\n    );\n  }\n} catch(e){\n//an unexpected error has just occurred. \n callback(e);}},\n  INTERNAL_SHOPPING: function(args, callback) {\ntry{\n{\n    let c = this.constants;\n    this.args.$nextStep.form.elements.push(\n      this.libs.createElement(\"jambRegNumber\", \"Matriculation Number\", \"\", c.ELEMENTTYPE.INPUT, { type: c.INPUTTYPE.TEXT }, [\n        this.libs.createRequiredValidator(),\n        this.libs.createRegexValidator(\"^\\\\d{6,8}[a-zA-Z]{2,2}$\", \"You must enter a valid jamb registration number\")\n      ])\n    );\n\n    return exports.$PHONE_NUMBER_PROVIDED.call(this, args, callback);\n  }\n} catch(e){\n//an unexpected error has just occurred. \n callback(e);}},\n  DIRECT_ENTRY: function(...args) {\n    exports.POST_UTME_SCREENING.apply(this, args);\n  },\n  ADMISSION_SHOPPING: function(...args) {\n    exports.POST_UTME_SCREENING.apply(this, args);\n  },\n  JUPEB_APP_FORM: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  },\n  PG_APP_FORM: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  },\n  DIPLOMA_UNDERGRADUATE: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  },\n  EXECUTIVE_DIPLOMA_FORM: function(...args) {\n    return exports.$PHONE_NUMBER_PROVIDED.apply(this, args);\n  }\n};\n"}]
